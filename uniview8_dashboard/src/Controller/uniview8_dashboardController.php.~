<?php

namespace Drupal\uniview8_dashboard\Controller;

use Drupal\Core\Controller\ControllerBase;
use Drupal\Core\Database;
class uniview8Dashboard extends ControllerBase {



public static function load($entry = array()) {
    $userCurrent = \Drupal::currentUser();
    $user = \Drupal\user\Entity\User::load($userCurrent->id());
    $uid = $user->getUsername();


$table = \Drupal::config('table.settings')->get('tablename');

$split = explode('_', $table);
$pgname = $split['1'];
$query = db_query("desc $table");
$name = array();


foreach($query as $values){
$field = $values->Field;
$name[$values->Field] = $values->Field;

$table = \Drupal::config('table.settings')->get('tablename');


$result1 = db_query("select memberid, membername, amount1, SUM(".$pgname."_amount), ROUND((amount1 - SUM(".$pgname."_amount)),2) as balance , DATE_FORMAT(billdate,'%Y%m')  from bill_details a left join ".$table." b on a.memberid = b.".$pgname."_memberid where particular1 = :TOTAL and b.".$pgname."_status = 's' and DATE_FORMAT(billdate,'%Y%m') = :amonth and DATE_FORMAT(paidtime,'%Y%m') = :bmonth group by amount1, memberid, membername, DATE_FORMAT(billdate,'%Y%m') order by balance desc limit 10", array (':TOTAL' => "TOTAL BILL AMOUNT", ':bmonth' => $y,':amonth' => $y));


return $result1;
}
    $rows = array();
    $headers = array(t(memberid),t(Amount));

    foreach ($entries = $this->load() as $entry) {





}

$content['mkup1'] = array(
     '#type' => 'markup',
     '#markup' => "<h1>".$result1['memberid"</h1><h2>".$memberid."</h2>",
      '#prefix' => "<table id='invtable'><tr><td>",
      '#suffix' => "</td>",
    );

 $content['mkup2'] = array(
     '#type' => 'markup',
     '#markup' => "<h3></h3><h3></h3>",
 '#prefix' => "<td>",
      '#suffix' => "</td></tr>",
    );
 $content['table'] = array(
      '#type' => 'table',
      '#header' => $headers,
      '#rows' => $rows,
      '#empty' => t('No entries available.'),
      '#suffix' => "</td>",
      '#id' => 'customers',
    );

$content['pasmkup'] = array(
     '#type' => 'markup',
     '#markup' => "<center><a href='/fetchmyBill' class='btnn'>Pay Bills</a></center>",
     '#prefix' => "<td><hr/>",
     '#suffix' => "</td></tr></table>",
    );


$content['#cache']['max-age'] = 0;

    return $content;
  }




}



