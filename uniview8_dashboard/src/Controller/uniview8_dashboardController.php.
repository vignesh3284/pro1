<?php

namespace Drupal\uniview8_dashboard\Controller;

use Drupal\Core\Controller\ControllerBase;
use Drupal\Core\Database;
class uniview8Dashboard extends ControllerBase {



public static function load($entry = array()) {
    $userCurrent = \Drupal::currentUser();
    $user = \Drupal\user\Entity\User::load($userCurrent->id());
    $uid = $user->getUsername();


$table = \Drupal::config('table.settings')->get('tablename');



$split = explode('_', $table);
$pgname = $split['1'];
$query = db_query("desc $table");
$memberid = array();

foreach($query as $values){
$field = $values->Field;
$name[$values->Field] = $values->Field;
}

$result1 = db_query("select memberid, membername, amount1, SUM(".$pgname."_amount), ROUND((amount1 - SUM(".$pgname."_amount)),2) as balance , DATE_FORMAT(billdate,'%Y%m')  from bill_details a left join ".$table." b on a.memberid = b.".$pgname."_memberid where particular1 = :TOTAL and b.".$pgname."_status = 's' and DATE_FORMAT(billdate,'%Y%m') = :amonth and DATE_FORMAT(paidtime,'%Y%m') = :bmonth group by amount1, memberid, membername, DATE_FORMAT(billdate,'%Y%m') order by balance desc limit 10", array (':TOTAL' => "TOTAL BILL AMOUNT", ':bmonth' => $y,':amonth' => $y));


return $result1; }
public function entryList() {
  $content = array();

  $rows = array();
    $headers = array(t(memberid),t(Amount));

  foreach ($result1 as $entry) {
$tmparray =  (array) $entry;
$tmparray["airpay_amount"] = .$tmparray["airpay_amount"];
$rows[] = array_map(''Drupal\Component\Utility\SafeMarkup::checkPlain', $tmparray);
$rows[] = array_map('Drupal\Component\Utility\SafeMarkup::checkPlain', (array) $tmp);

}
 $content['table'] = array(
      '#type' => 'table',
      '#header' => $headers,
      '#rows' => $rows,
      '#empty' => t('No entries available.'),
    );
    // Don't cache this page.
    $content['#cache']['max-age'] = 0;

    return $content;
  }

}



